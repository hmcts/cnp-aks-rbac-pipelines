{"tasks":[{"environment":{},"displayName":"Create Managed Identity for AKS","alwaysRun":false,"continueOnError":false,"condition":"eq(variables['Deploy.Cluster-Post'],'true')","enabled":true,"timeoutInMinutes":0,"inputs":{"ConnectedServiceName":"$(Task.Subscription)","action":"Create Or Update Resource Group","resourceGroupName":"$(Task.AKS.ResourceGroup)","location":"$(Location)","templateLocation":"Linked artifact","csmFileLink":"","csmParametersFileLink":"","csmFile":"$(System.DefaultWorkingDirectory)/_aks-rbac-pipelines-CI/drop/templates/arm-mi-template.json","csmParametersFile":"","overrideParameters":"-resourceName $(Task.AKS.ClusterName.Mi)","deploymentMode":"Incremental","enableDeploymentPrerequisites":"None","deploymentGroupEndpoint":"","project":"","deploymentGroupName":"","copyAzureVMTags":"true","runAgentServiceAsUser":"false","userName":"","password":"","outputVariable":"","deploymentName":"","deploymentOutputs":"miOutputs","addSpnToEnvironment":"false"},"task":{"id":"94a74903-f93f-4075-884f-dc11f34058b4","versionSpec":"2.*","definitionType":"task"}},{"environment":{},"displayName":"Parse miOutputs outputs","alwaysRun":false,"continueOnError":false,"condition":"eq(variables['Deploy.Cluster-Post'],'true')","enabled":true,"timeoutInMinutes":0,"inputs":{"targetType":"filePath","filePath":"$(System.DefaultWorkingDirectory)/_aks-rbac-pipelines-CI/drop/scripts/publish-arm-outputs.sh","arguments":"'$(miOutputs)'","script":"# Write your commands here\n\n# Use the environment variables input below to pass secret variables to this script","workingDirectory":"$(System.DefaultWorkingDirectory)/_aks-rbac-pipelines-CI/drop","failOnStderr":"false","noProfile":"true","noRc":"true"},"task":{"id":"6c731c3c-3c68-459a-a5c9-bde6e6595b5b","versionSpec":"3.*","definitionType":"task"}},{"environment":{},"displayName":"Permissions MI to Key Vault","alwaysRun":false,"continueOnError":true,"condition":"eq(variables['Deploy.Cluster-Post'],'true')","enabled":true,"timeoutInMinutes":0,"inputs":{"connectedServiceNameARM":"f69cf6ae-6cd8-430b-a269-e7f1c5a06098","scriptLocation":"scriptPath","scriptPath":"$(System.DefaultWorkingDirectory)/_aks-rbac-pipelines-CI/drop/scripts/set-keyvault-permissions.sh","inlineScript":"","args":"\"$(Task.KeyVault)\" \"$(miPrincipalID)\"","addSpnToEnvironment":"false","useGlobalConfig":"false","cwd":"$(System.DefaultWorkingDirectory)/_aks-rbac-pipelines-CI/drop","failOnStandardError":"false"},"task":{"id":"46e4be58-730b-4389-8a2f-ea10b3e5e815","versionSpec":"1.*","definitionType":"task"}}],"runsOn":["Agent","DeploymentGroup"],"revision":1,"createdBy":{"displayName":"Martin Palmer","id":"b0b049d4-4962-60c3-b214-94ae9fb50f1c","uniqueName":"Martin.Palmer@HMCTS.NET"},"createdOn":"2019-05-07T15:24:42.020Z","modifiedBy":{"displayName":"Martin Palmer","id":"b0b049d4-4962-60c3-b214-94ae9fb50f1c","uniqueName":"Martin.Palmer@HMCTS.NET"},"modifiedOn":"2019-05-07T15:24:42.020Z","id":"4dbe2ca7-5b8a-4265-a543-23b77de6cd7e","name":"AKS-Cluster-Post","version":{"major":1,"minor":0,"patch":0,"isTest":false},"iconUrl":"https://cdn.vsassets.io/v/M151_20190503.6/_content/icon-meta-task.png","friendlyName":"AKS-Cluster-Post","description":"","category":"Deploy","definitionType":"metaTask","author":"Martin Palmer","demands":[],"groups":[],"inputs":[{"aliases":[],"options":{},"properties":{"EditableOptions":"True"},"name":"Location","label":"Location","defaultValue":"$(Location)","required":true,"type":"pickList","helpMarkDown":"Location for deploying the resource group. If the resource group already exists in the subscription, then this value will be ignored.","groupName":""},{"aliases":[],"options":{},"properties":{},"name":"Task.AKS.ClusterName.Mi","label":"Task.AKS.ClusterName.Mi","defaultValue":"$(aksClusterName-mi)","required":true,"type":"string","helpMarkDown":"","groupName":""},{"aliases":[],"options":{},"properties":{"EditableOptions":"True"},"name":"Task.AKS.ResourceGroup","label":"Task.AKS.ResourceGroup","defaultValue":"$(aksResourceGroup)","required":true,"type":"pickList","helpMarkDown":"Provide the name of a resource group.","groupName":""},{"aliases":[],"options":{},"properties":{},"name":"Task.KeyVault","label":"Task.KeyVault","defaultValue":"$(keyvaultName)","required":true,"type":"string","helpMarkDown":"","groupName":""},{"aliases":[],"options":{},"properties":{},"name":"Task.Subscription","label":"Task.Subscription","defaultValue":"","required":true,"type":"connectedService:AzureRM","helpMarkDown":"Select the Azure Resource Manager subscription for the deployment.","groupName":""}],"satisfies":[],"sourceDefinitions":[],"dataSourceBindings":[],"instanceNameFormat":"Task group: AKS-Cluster-Post $(Location)","preJobExecution":{},"execution":{},"postJobExecution":{}}