digraph g {
    subgraph clusterSubscription {
        label = "Subscription";

        subgraph clusterEnvironmentRg{
            label = "Environment";

            envPattern[shape=record label="{naming pattern|{core|infra|#env#}|{example|core-infra-concept}}"];


            subgraph clusterVNET{
                label = "Networking";

                vnetpattern[shape=record label="{VNET|{core|#env#|vnet}|{example|core-concept-vnet}}"];
                subpattern[shape=record label="{subnet|{core|#env#|vnet|sub|#index#}|{example|core-concept-vnet-sub01}}"];

                subgraph clusterSub00{
                    label = "";
                    subnet00[shape=Mrecord label="{subnet|{{index|01}}}"];
                }
                subgraph clusterSub01{
                    label = "";
                    subnet01[shape=Mrecord label="{subnet|{{index|01}}}"];
                }
                vnetpattern->subpattern;
                subpattern->subnet00;
                subpattern->subnet01;
            }

            subgraph clusterManagedIdentity{
                label = "Managed Identity";
                mipattern[shape=record label="{naming pattern|{|core|#env#|cluster|#index#|mi}|{example|core-concept-cluster-00-mi}}"];
                mi00[shape=Mrecord label="{Managed Identity|{{index|00}}}"];
                mipattern->mi00;

            }

            subgraph clusterKeyvault {
                label = "keyvault";
                kvpattern[shape=record label="{naming pattern|{#team#|infra}|{example|rep-infra}}"];


                kv00[shape=Mrecord label="{key Vault|{{index|00}}}|{secrets|{aks-sapp-secret|aks-sp-id|aks-sp-secret|slack-webhook-url}}}}"];
                kvpattern->kv00;

            }

            subgraph clusterKubernatesService {
                label = "Kubernetes";
                k8pattern[shape=record label="{naming pattern|{aks|#env#|cluster|#index#}|{example|core-concept-cluster}}"];
                k800[shape=Mrecord label="{Kubernetes Service|{{index|00}}}}"];
                k801[shape=Mrecord label="{Kubernetes Service|{{index|01}}}}"];
                k8pattern->k800;
                k8pattern->k801;
            }
        }

        subgraph clusterMonitoringRg {
            label = "Monitoring";
            LogicApp[shape=Mrecord label="{naming pattern|{core|#env#|monitoring|la}|{example|core-concept-monitoring-la}}"];
            mon00[shape=Mrecord label="{Logic App|monitoring}}}"];
            LogicApp->mon00;

        }
        

        subgraph clusterManagedCluxterRg {
                label = "";
                mcpattern[shape=record label="{naming pattern|{MC|core|#env#|rg|core|#env#|#cluster#|#index#|}|{example|MC_core-concept-rg-core-concept-cluster-00_uksouth}}"];
                mc00[shape=Mrecord label="{Managec Cluster Resource Group|{index|00}}}}"];
                mcpattern->mc00;
                
                subgraph clusterk8 {
                NSG[shape=Mrecord label="{Network Security Group}}"];                                
                VM[shape=record label="{Disk|{#env#|#nodepool#|id|instance}|{example|concept-nodepool1-22607330-0}}"];
                vm00[shape=Mrecord label="{Kubernetes Service|{{instance|00}}}}"];
                vm01[shape=Mrecord label="{Kubernetes Service|{{instance|01}}}}"];
                VM->vm00;
                VM->vm01;

//                VM[shape=box];
                NIC[shape=record label="{Network Interface|{#env#|#nodepool#|nic|index}|{example|concept-nodepool1-nic-0}}"];

                nic00[shape=Mrecord label="{Network Interface|{{index|00}}}}"];
                nic01[shape=Mrecord label="{Network Interface|{{index|01}}}}"];
                NIC->nic00;
                NIC->nic01;
                AS[shape=record label="{Availability Set|{#env#|availabilitySet|#instance}|{example|concept-availablitySet-22607330}}"];
                AS00[shape=Mrecord label="{Network Interface|{environment|#env#}}}}"];
                
                AS00->vm00;
                AS00->vm01;

                }


        }

    }

}